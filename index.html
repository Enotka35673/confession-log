<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Confession Log XVII</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: black;
      color: #00ffcc;
      font-family: 'VT323', monospace;
      text-align: center;
      padding: 2em;
    }
    .quote {
      color: fuchsia;
    }
    #output {
      white-space: pre-wrap;
      font-size: 1.5em;
      margin-top: 1em;
    }
    #startBtn {
      margin-top: 2em;
      padding: 0.5em 1em;
      font-size: 1em;
      cursor: pointer;
    }
    #screamer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: red;
      font-size: 3em;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="output"></div>
  <button id="startBtn">Начать</button>
  <div id="screamer">░░░ WE SEE YOU ░░░</div>

  <audio id="typeSound" src="type.mp3"></audio>
  <audio id="ambientSound" src="ambient.mp3" loop></audio>
  <audio id="screamSound" src="scream.mp3"></audio>

  <script>
    const output = document.getElementById('output');
    const typeSound = document.getElementById('typeSound');
    const ambientSound = document.getElementById('ambientSound');
    const screamSound = document.getElementById('screamSound');
    const screamer = document.getElementById('screamer');
    const startBtn = document.getElementById('startBtn');

    const textParts = [
      `>> CONFESSION-LOG_0173 :: ACCESS GRANTED
>> SYSTEM MESSAGE: ERROR_173: CONFESSION CORRUPTED

>> Parsing soul fragment...

>> [IN LUMEN VERITAS]
...`,

      `>> SUBJECT 0173: “<span class='quote'>I prayed. No one answered.</span>”
>> SUBJECT 0173: “<span class='quote'>I heard laughter in the static.</span>”

>> Faith checksum: NULL`,

      `>> > SYSTEM RESPONSE:
░░░ WE SEE YOU ░░░`
    ];

    let part = 0;

    async function typeText() {
      if (part >= textParts.length) return;
      const current = textParts[part];
      output.innerHTML = '';
      for (let i = 0; i < current.length; i++) {
        const char = current[i];
        output.innerHTML += char;
        if (char !== ' ' && char !== '\\n') typeSound.play();
        if (char === '.' && current.slice(i, i + 3) === '...') {
          for (let j = 0; j < 2; j++) {
            await new Promise(r => setTimeout(r, 400));
            output.innerHTML = output.innerHTML.slice(0, -3);
            await new Promise(r => setTimeout(r, 300));
            output.innerHTML += '...';
          }
          i += 2;
        } else {
          await new Promise(r => setTimeout(r, 45));
        }
      }
      part++;
      if (part < textParts.length) {
        await new Promise(r => setTimeout(r, 1200));
        typeText();
      } else {
        ambientSound.pause();
        screamer.style.display = 'flex';
        screamSound.play();
      }
    }

    startBtn.addEventListener('click', () => {
      startBtn.style.display = 'none';
      ambientSound.volume = 0.3;
      ambientSound.play();
      typeText();
    });
  </script>
</body>
</html>
